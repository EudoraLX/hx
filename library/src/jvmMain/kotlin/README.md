# Excel 表格合并器 - 代码结构说明

## 项目结构

```
library/src/jvmMain/kotlin/
├── Main.kt                          # 主程序入口
├── ui/                              # UI模块
│   ├── UIManager.kt                 # UI管理器 - 统一管理所有UI组件
│   ├── FileManagementPanel.kt       # 文件管理面板
│   ├── OrderRemovalPanel.kt         # 订单移除面板
│   └── SchedulingPanel.kt           # 智能排产面板
├── core/                            # 核心业务逻辑
│   ├── SmartTableMerger.kt          # 智能表格合并器
│   ├── SmartScheduler.kt            # 智能排产调度器
│   └── OrderConverter.kt            # 订单数据转换器
├── model/                           # 数据模型
│   ├── TableData.kt                 # 表格数据模型
│   └── ProductionOrder.kt           # 生产订单数据模型
└── excel/                           # Excel处理模块
    ├── ExcelReader.kt               # Excel读取器
    └── ExcelExporter.kt             # Excel导出器
```

## 模块说明

### 1. Main.kt
- **职责**: 程序入口点
- **功能**: 启动应用程序，创建UI管理器

### 2. UI模块 (ui/)

#### UIManager.kt
- **职责**: UI管理器，统一管理所有UI组件
- **功能**: 
  - 创建主窗口和面板
  - 管理全局状态变量
  - 提供预览更新功能
  - 协调各个面板之间的交互

#### FileManagementPanel.kt
- **职责**: 文件管理功能
- **功能**:
  - 导入Excel文件
  - 管理已导入的表格列表
  - 执行智能合并
  - 导出合并结果

#### OrderRemovalPanel.kt
- **职责**: 已完成订单移除功能
- **功能**:
  - 配置比较列（计划发货数量 vs 已发货数）
  - 预览移除结果
  - 执行订单移除
  - 恢复原始数据

#### SchedulingPanel.kt
- **职责**: 智能排产功能
- **功能**:
  - 选择排产策略（产能优先、时间优先、订单优先、平衡策略）
  - 设置排产参数和约束条件
  - 转换订单数据
  - 生成排产计划
  - 导出排产结果

### 3. 核心业务逻辑 (core/)

#### SmartTableMerger.kt
- **职责**: 智能表格合并
- **功能**:
  - 执行表格智能合并
  - 移除已完成的订单
  - 提供合并结果预览

#### SmartScheduler.kt
- **职责**: 智能排产调度
- **功能**:
  - 实现多种排产策略
  - 处理排产约束条件
  - 计算机台利用率
  - 生成排产统计信息

#### OrderConverter.kt
- **职责**: 订单数据转换
- **功能**:
  - 将Excel数据转换为生产订单对象
  - 将生产订单转换回表格数据
  - 创建默认机台配置

### 4. 数据模型 (model/)

#### TableData.kt
- **职责**: 表格数据模型
- **功能**: 定义表格数据结构和基本操作

#### ProductionOrder.kt
- **职责**: 生产订单数据模型
- **功能**: 
  - 定义生产订单的完整数据结构
  - 包含订单优先级、状态等枚举
  - 定义排产策略和约束条件

### 5. Excel处理模块 (excel/)

#### ExcelReader.kt
- **职责**: Excel文件读取
- **功能**: 读取Excel文件并转换为内部数据格式

#### ExcelExporter.kt
- **职责**: Excel文件导出
- **功能**: 将内部数据格式导出为Excel文件

## 设计原则

### 1. 单一职责原则
每个类都有明确的单一职责，便于维护和测试。

### 2. 模块化设计
功能按模块划分，降低耦合度，提高可维护性。

### 3. 分层架构
- UI层：负责用户界面和交互
- 业务逻辑层：处理核心业务逻辑
- 数据层：定义数据模型和存储

### 4. 依赖注入
通过构造函数注入依赖，便于测试和扩展。

## 使用说明

### 1. 文件管理
1. 点击"导入表格"按钮选择Excel文件
2. 在文件列表中查看已导入的表格
3. 点击"智能合并"进行表格合并
4. 点击"导出合并结果"保存结果

### 2. 订单移除
1. 在"订单移除"标签页中配置比较列
2. 点击"预览移除"查看将要移除的订单
3. 点击"执行移除"完成订单移除
4. 如需恢复，点击"恢复数据"

### 3. 智能排产
1. 在"智能排产"标签页中选择排产策略
2. 设置排产参数和约束条件
3. 点击"转换订单"将表格数据转换为订单对象
4. 点击"生成排产计划"执行排产
5. 点击"导出排产"保存排产结果

## 扩展说明

### 添加新的排产策略
1. 在 `SchedulingStrategy` 枚举中添加新策略
2. 在 `SmartScheduler` 中添加对应的实现方法
3. 在 `SchedulingPanel` 中添加UI选项

### 添加新的数据字段
1. 在 `ProductionOrder` 数据类中添加新字段
2. 在 `OrderConverter` 中更新转换逻辑
3. 在相应的UI面板中添加显示和编辑控件

### 添加新的导出格式
1. 创建新的导出器类（如 `CSVExporter`）
2. 在相应的面板中添加导出选项
3. 实现具体的导出逻辑
